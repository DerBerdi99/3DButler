{% extends 'base.html' %}

{% block title %}Meine Bestellungen{% endblock %}

{% block extra_styles %}

<style>
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh; /* Volle H√∂he des Viewports */
    }

    .input-group {
        margin-bottom: 15px;
        width: 100%;
        max-width: 400px; /* Maximale Breite der Eingabefelder */
    }
    .input-group label {
        display: block;
        margin-bottom: 5px;
        color: #f1f1f1;
    }
    .input-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .button-group {
        display: flex;
        justify-content: space-between;
        width: 100%;
        max-width: 400px;
        margin-top: 20px;
    }
    .button-group button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
    }
    .button-group button:hover {
        background-color: #45a049;
    }
    /* ----------------------------------------------------------------- */
    /* MODIFIED STYLES (Angepasst f√ºr Zentrierung und Layout) */
</style>

{% endblock %}

{% block body %}
<meta name="viewport" content="width=device-width, initial-scale=1">

      <div class="col " style="margin: 13px;">
        <div class="list-group text-center" >

            <a href="{{ url_for('views.shop') }}" class="list-group-item list-group-item-action">
                <i class="shop-link" aria-hidden="true"></i>
                <span class="link-name">Shop</span>
            </a>
            <a href="{{ url_for('views.start_project') }}" class="list-group-item list-group-item-action">
                <i class="project-link" aria-hidden="true"></i>
                <span class="link-name">Projekt starten</span>
            </a>
            <a href="{{ url_for('views.my_reviews') }}" class="list-group-item list-group-item-action">
                <i class="reviews-link"></i>
                <span class="link-name">Meine Reviews</span>
            </a>
            <a href="{{ url_for('views.my_orders') }}" class="list-group-item list-group-item-action">
                <i class="orders-link"></i>
                <span class="link-name">Meine Bestellungen</span>
            </a>

        </div>
      </div>


<div class="container mt-4">
    <h1>Meine Bestellungen ({{ orders|length }} Bestellungen)</h1>
    <p class="p-site-description">Hier finden Sie eine √úbersicht √ºber Ihre bisherigen Bestellungen und deren Status.</p>

    {% if orders %}
        <div class="row">
            {# Iteriere √ºber alle Bestellungen des Benutzers #}
            {% for order in orders %}
            <div class="col-12 col-md-6 col-lg-4 mb-4">

                <div class="card shadow-sm h-100 border
                    {% if order.OrderStatus == 'PAID' %}border-success{% elif order.OrderStatus == 'CANCELLED' %}border-danger{% else %}border-warning{% endif %}">

                    <div class="card-body d-flex flex-column">

                        <h5 class="card-title text-primary">Bestellnummer: {{ order.OrderID }}</h5>
                        <p class="mb-1">
                            <strong>Status:</strong>
                            <span class="badge
                                {% if order.OrderStatus == 'ORDER_FINALIZED' %}bg-warning
                                {% elif order.OrderStatus == 'PAID' %}bg-success
                                {% elif order.OrderStatus == 'CANCELLED' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ order.OrderStatus | replace('_', ' ') }}
                            </span>
                        </p>
                        <p class="card-text small mb-2">
                             Bestelldatum: {{ order.OrderDate | default('N/A') }}
                        </p>
                        <p class="card-text small mb-2">
                            St√ºckzahl: {{ order.Quantity | default('N/A') }} St√ºck
                        </p>
                        <p class="card-text text-muted small mt-auto">
                            Gesamtbetrag: {{ order.OrderAmount }} ‚Ç¨
                        </p>
                        {% if order.OrderStatus == 'CANCELLED' %}
                            <p class="card-text text-danger small">
                                Bestellung wurde storniert.
                            </p>

                        {% elif order.OrderStatus == 'ORDER_FINALIZED' %}
                            <p class="card-text text-warning small">
                                Zahlung ausstehend. Bitte schlie√üen Sie die Zahlung ab.
                            </p>
                            <a href="{{ url_for('views.order_detail', order_id=order.OrderID) }}" class="btn btn-sm btn-info mt-3">
                                Bestelldetails anzeigen
                            </a>
                        
                        {% elif order.OrderStatus == 'DRAFT' %}
                            <a href="{{ url_for('views.checkout_entry', order_id=order.OrderID) }}" class="btn btn-sm btn-success mt-3 mb-2">
                                üõí Zahlung/Adresse fortsetzen
                            </a>
                            <a href="{{ url_for('views.order_detail', order_id=order.OrderID) }}" class="btn btn-sm btn-info mt-3">
                                Bestelldetails anzeigen
                            </a>
                        {% else %}
                            <p class="card-text text-warning small">
                                Bestellung bezahlt.
                            </p>
                        {% endif %}
                        
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info mt-5 text-center" role="alert">
            <h4 class="alert-heading">Noch keine Bestellungen gefunden!</h4>
            <p>Es wurden noch keine Bestellungen unter Ihrem Konto aufgegeben. St√∂bern Sie in unserem Shop und t√§tigen Sie Ihre erste Bestellung.</p>
            <hr>
            <a href="{{ url_for('views.shop') }}" class="btn btn-primary">Zum Shop gehen</a>
        </div>
    {% endif %}
</div>
{% endblock %}