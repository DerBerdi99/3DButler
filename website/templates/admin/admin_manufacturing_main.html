{% extends 'admin/admin_base.html' %}

{% block title %} Fertigungssteuerung {% endblock %}

{% block cart_icon %}

{% endblock %}

{% block wishlist_icon %}

{% endblock %}

{% block body %}
<div class="container text-center mt-4">
    <h1 class="mb-2 text-primary">Manufacturing Control</h1>
    <div id="flash-container" class="d-flex mt-3">
        <div id="flash-container-left" class="me-auto"></div>
        <div id="flash-container-center" class="mx-auto"></div>
        <div id="flash-container-right" class="ms-auto"></div>
    </div>
    <div class="d-flex justify-content-center mb-4">
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="rotateSections()">
            <i class="fa-solid fa-sync"></i> Ansicht rotieren
        </button>
    </div>

    <div id="section-wrapper" class="d-flex flex-column">
        
        <div id="sec-blueprints" class="m-section mb-5 px-3">
            <h3 class="text-primary border-bottom pb-2">1. Blueprints (Engineering)</h3>
            <p class="site-description small text-muted">Technische Datenerfassung und BOM-Erstellung.</p>
            {% include 'admin/admin_blueprints.html' %}
        </div>

        <div id="sec-jobs" class="m-section mb-5 px-3">
            <h3 class="text-success border-bottom pb-2">2. Fertigungsjobs (Pool)</h3>
            <p class="site-description small text-muted">Warteschlange für die Maschinenbelegung.</p>
            {% include 'admin/admin_jobs.html' %}
        </div>

        <div id="sec-printers" class="m-section mb-5 px-3">
            <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                <h3 class="text-warning mb-0">3. Drucker (Live-Status)</h3>
                <button class="btn btn-sm btn-outline-warning" onclick="">+ Drucker Initialisieren</button>
            </div>
            
            <div class="bg-dark p-3 rounded border border-secondary border-opacity-25">
                {% include 'admin/admin_printers.html' %}
            </div>
        </div>
        
    </div>
</div>

<div id="static-modal-container">
    {% include 'admin/admin_manufacturing_modals.html' %}
</div>

{% endblock %}

{% block scripts %}
<script>

function rotateSections() {
    const wrapper = document.getElementById('section-wrapper');
    const sections = [
        document.getElementById('sec-blueprints'),
        document.getElementById('sec-jobs'),
        document.getElementById('sec-printers')
    ];

    // Animation-Klasse vom Wrapper entfernen (für Reset)
    wrapper.classList.remove('section-scan');
    
    // Kurzer Force-Reflow, damit der Browser merkt, dass die Klasse weg ist
    void wrapper.offsetWidth;

    // Physische Rotation
    const currentFirst = Array.from(wrapper.children).find(child => sections.includes(child));
    if (currentFirst) {
        wrapper.appendChild(currentFirst);
    }

    // Animation wieder drauf
    wrapper.classList.add('section-scan');
}

</script>

<script id="inventory-data" type="application/json">
    {{ materials_list | default([]) | tojson | safe }}
</script>
<script id="profiles-data" type="application/json">
    {{ print_profiles_list | default([]) | tojson | safe }}
</script>

<script type="module" src="{{ url_for('static', filename='js/admin_blueprints.js') }}"></script>

<script type="module" src="{{ url_for('static', filename='js/admin_printers.js') }}"></script>

<script type="module" src="{{ url_for('static', filename='js/admin_jobs.js') }}"></script>

{% endblock %}