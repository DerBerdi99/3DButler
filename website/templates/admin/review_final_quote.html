{% extends "base.html" %}
{% block body %}

    <div class="container mt-4">
        <h2><strong>{{ title }}</strong>(Material: {{ project.MaterialType }})</h2>

        <div class="alert alert-info">
            <strong>Status:</strong> {{ project.Status | replace('_', ' ') }}
        </div>

        <div class="card p-4 mb-4 shadow-sm" id="calculation-basis-card">
            <h5>Berechnungsgrundlage (Ad-hoc) ðŸ“Š</h5>

            <form method="POST" action="{{ url_for('admin_views.review_final_quote', project_id=project.ProjectID) }}">
                <input type="hidden" name="form_type" value="calculation">

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="volume_cm3" class="form-label">Volumen (cmÂ³)</label>
                            <input type="number" step="0.01" class="form-control" id="volume_cm3" name="volume_cm3" value="{{ calculation_data.volume_cm3 }}">
                        </div>
                        <div class="mb-3">
                            <label for="material_g" class="form-label">Materialverbrauch (g)</label>
                            <input type="number" step="0.1" class="form-control" id="material_g" name="material_g" value="{{ calculation_data.material_g }}">
                        </div>
                        <div class="mb-3">
                            <label for="print_time_min" class="form-label">Druckzeit (Minuten)</label>
                            <input type="number" class="form-control" id="print_time_min" name="print_time_min" value="{{ calculation_data.print_time_min }}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="profile_id" class="form-label">Druckprofil</label>
                            <select class="form-select" id="profile_id" name="profile_id">
                                {% for profile in print_profiles %}
                                    <option value="{{ profile.ProfileID }}" {% if profile.ProfileID == calculation_data.profile_id %}selected{% endif %}>
                                        {{ profile.ProfileName }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="material_name_calc" class="form-label">Material (genaue Art)</label>
                            <select class="form-select" id="material_name_calc" name="material_name_calc">
                                {% for material in materials %}
                                    <option value="{{ material.MaterialName }}" {% if material.MaterialName == calculation_data.material_name %}selected{% endif %}>
                                        {{ material.MaterialName }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-info w-100">
                            Preis ad-hoc berechnen
                        </button>
                    </div>
                </div>
            </form>
        </div>

            <div class="alert alert-info">
                </div>

        </div>
        <div class="container mt-4">
        <form method="POST" action="{{ url_for('admin_views.review_final_quote', project_id=project.ProjectID) }}" enctype="multipart/form-data">
            <input type="hidden" name="form_type" value="save">
            <div class="row">

                <div class="col-md-6">
                    <div class="card p-4 mb-4 shadow-sm">
                        <h5>Angebotsdetails</h5>

                        <div class="mb-3">
                            <label for="quote_price" class="form-label">Finaler Angebotspreis (â‚¬)</label>
                            <input type="number" step="0.01" min="0.01" class="form-control" id="quote_price"
                                   name="quote_price" value="{{ suggested_price }}" required>
                            <small class="form-text text-muted">Vorgeschlagener Preis: {{ suggested_price }} â‚¬</small>
                        </div>

                        <div class="mb-3">
                            <label for="product_name" class="form-label">Produktname (fÃ¼r den Shop)</label>
                            <input type="text" class="form-control" id="product_name"
                                   name="product_name" value="{{ project.ProjectName }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="category_name" class="form-label">Produktkategorie</label>
                            <select class="form-select" id="category_name" name="category_name" required>
                                <option value="" disabled>WÃ¤hlen Sie eine Kategorie</option>
                                {% for cat in categories %}
                                    <option value="{{ cat }}">{{ cat }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="image_url" class="form-label">Produktbild (URL oder Platzhalter)</label>
                            <input type="text" class="form-control" id="image_url"
                                   name="image_url" placeholder="Geben Sie eine Bild-URL ein...">
                        </div>
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" value="on" id="IsShopReady" name="IsShopReady">
                            <label class="form-check-label" for="IsShopReady">
                                **Produkt fÃ¼r den Shop freigeben** (Kunde hat zugestimmt)
                            </label>
                        </div>
                        <div>
                            <input type="hidden" name="volume_cm3" value="{{ calculation_data.volume_cm3 }}">
                            <input type="hidden" name="material_g" value="{{ calculation_data.material_g }}">
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card p-4 mb-4 shadow-sm">
                        <h5>Interne Details & Parameter (FÃ¼r Products-Tabelle)</h5>

                        <div class="mb-3">
                            <label for="weight" class="form-label">Gewicht (g)</label>
                            <input type="number" step="0.1" class="form-control" id="weight"
                                   name="weight" value="50.0" required>
                        </div>

                        <div class="mb-3">
                            <label for="print_time" class="form-label">Druckzeit (Minuten)</label>
                            <input type="number" class="form-control" id="print_time"
                                   name="print_time" value="300" required>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Produktbeschreibung</label>
                            <textarea class="form-control" id="description" name="description" rows="5" required>Basierend auf dem Kundenprojekt {{ project.ProjectName }}. Ein hochprÃ¤ziser 3D-Druck.</textarea>
                        </div>

                    </div>
                </div>

            </div>

            <button type="submit" class="btn btn-lg btn-primary w-100 mt-3">
                Angebot erstellen & zur KundenprÃ¼fung freigeben
            </button>
            <a href="{{ url_for('admin_views.review_projects') }}" class="btn btn-secondary mt-2 w-100">Abbrechen</a>

        </form>
        <br>
    </div>
</div>

{% endblock %}